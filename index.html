<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Farmacia DP v1</title>
  <link rel="stylesheet" href="style.css?v=dp-1.9"/>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0"/>
</head>
<body>
  <!-- Sidebar -->
  <aside id="sidebar" class="sidebar">
    <div class="brand">
      <img id="brandLogo" class="brand-logo" alt="Logo"/>
      <button id="btnToggle" class="icon-btn" aria-label="Contraer/Expandir">‚ò∞</button>
      <span class="brand-title">Farmacia DP v1</span>
    </div>
    <nav class="nav">
      <button class="nav-link active" data-section="dashboard">üìä Dashboard</button>
      <button class="nav-link" data-section="ventas">üßæ Ventas</button>
      <button class="nav-link" data-section="inventario">üíä Inventario</button>
      <button class="nav-link" data-section="bodega">üè∑Ô∏è Bodega</button>
      <button class="nav-link" data-section="clientes">üë§ Clientes</button>
      <button class="nav-link" data-section="historial">üßæ Historial</button>
      <button class="nav-link" data-section="reportes">üìà Reportes</button>
      <button class="nav-link" data-section="config">‚öôÔ∏è Configuraci√≥n</button>
    </nav>
  </aside>

  <!-- Main -->
  <main class="content">
    <header class="topbar">
      <button id="btnOpen" class="icon-btn show-on-mobile">‚ò∞</button>
      <h1 id="sectionTitle">Dashboard</h1>
      <!-- Nota: dej√© el buscador global; lo retiramos cuando entremos a la parte del "s√∫per buscador" de Ventas -->
      <input id="globalSearch" type="search" placeholder="Buscar‚Ä¶"/>
    </header>

    <!-- ============= DASHBOARD ============= -->
    <section id="dashboard" class="view active">
      <!-- KPIs superiores -->
      <div class="grid kpis kpis-6">
        <div class="card kpi">Ventas Hoy <strong id="kpiVentasHoy">$0.00</strong></div>
        <div class="card kpi">Tickets Hoy <strong id="kpiTicketsHoy">0</strong></div>
        <div class="card kpi">Ticket promedio <strong id="kpiTicketProm">$0.00</strong></div>
        <div class="card kpi">IVA Hoy <strong id="kpiIvaHoy">$0.00</strong></div>
        <div class="card kpi">Ventas del mes <strong id="kpiVentasMes">$0.00</strong></div>
        <div class="card kpi">Top Hoy <strong id="kpiTopHoy">‚Äî</strong></div>
      </div>

      <!-- Alertas -->
      <div class="grid2 dash-row">
        <div class="card">
          <h3>Alertas</h3>
          <div class="alerts">
            <span class="chip info" id="alSolPend">Solicitudes Pendientes: 0</span>
            <span class="chip warn" id="alSolParc">Solicitudes Parciales: 0</span>
            <span class="chip warn" id="alStockBajo">Stock bajo: 0</span>
            <span class="chip danger" id="alStockCritico">Stock cr√≠tico (=5): 0</span>
            <span class="chip warn" id="alCadProx">Pr√≥x. a caducar (‚â§30d): 0</span>
            <span class="chip danger" id="alCadVenc">Caducados: 0</span>
            <span class="chip info" id="alSinPisoConBod">Sin piso con bodega: 0</span>
          </div>
          <div class="quick-actions">
            <button class="btn" data-goto="ventas">+ Nueva venta</button>
            <button class="btn" data-goto="bodega">Ingresar a bodega</button>
            <button class="btn" data-act="surtir">Surtir a inventario</button>
            <button class="btn" data-act="nuevaSol">Nueva solicitud</button>
            <button class="btn" data-act="nuevoCliente">Nuevo cliente</button>
            <button class="btn" data-goto="reportes">Reporte diario</button>
          </div>
        </div>

        <!-- Donut de pagos -->
        <div class="card">
          <h3>Formas de pago (hoy)</h3>
          <div class="chart-center">
            <svg id="chDonutPago" viewBox="0 0 120 120" class="chart-donut"></svg>
            <div class="legend" id="legDonutPago"></div>
          </div>
        </div>
      </div>

      <!-- Gr√°ficas -->
      <div class="grid2 dash-row">
        <div class="card">
          <h3>Ventas √∫ltimos 7 d√≠as</h3>
          <svg id="ch7d" viewBox="0 0 600 220" class="chart"></svg>
        </div>
        <div class="card">
          <h3>Surtidos (Solicitado vs Atendido ¬∑ 7 d√≠as)</h3>
          <svg id="chSurtidos" viewBox="0 0 600 220" class="chart"></svg>
        </div>
      </div>

      <!-- Listas recientes -->
      <div class="grid2 dash-row">
        <div class="card">
          <h3>√öltimas 10 ventas</h3>
          <div class="table-wrap">
            <table class="table" id="tblUltimas">
              <thead><tr><th>Fecha/Hora</th><th>Total</th><th>Pago</th><th>Acciones</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
        <div class="card">
          <h3>Kardex reciente</h3>
          <div class="table-wrap">
            <table class="table" id="tblKardex">
              <thead><tr><th>Fecha</th><th>Tipo</th><th>Detalle</th><th>Cant.</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- ============= VENTAS ============= -->
    <section id="ventas" class="view">
      <div class="ventas-topbar card">
        <input type="search" id="ventaBuscar" class="search-xl" placeholder="Buscar por nombre, SKU o etiqueta‚Ä¶ (Enter = SKU r√°pido)"/>
        <div class="scanner">
          <label for="barcodeInput">Esc√°ner:</label>
          <input id="barcodeInput" type="text" placeholder="Apunta el lector aqu√≠‚Ä¶"/>
          <button id="reactivarScanner" class="btn">Reactivar</button>
        </div>
      </div>

      <div class="ventas-wrap">
        <div id="catalogoProductos" class="catalogo"></div>

        <aside id="carritoPanel" class="carrito">
          <h3>Carrito</h3>
          <ul id="carritoLista" class="list slim"><li>(Vac√≠o)</li></ul>

          <div class="extras">
            <h4>Extras</h4>
            <div class="extras-row">
              <input id="extraDesc" type="text" placeholder="Descripci√≥n (ej. Curaci√≥n)"/>
              <input id="extraMonto" type="number" step="0.01" placeholder="Monto"/>
              <button id="btnAgregarExtra" class="btn">Agregar extra</button>
            </div>
            <ul id="extrasLista" class="list slim"></ul>
          </div>

          <div class="receta">
            <h4>Receta del paciente</h4>
            <input id="recetaFile" type="file" accept="image/*,.pdf"/>
            <img id="recetaPreview" class="receta-preview" alt="Vista previa"/>
          </div>

          <div class="total"><span>Total:</span><strong id="total">$0.00</strong></div>
          <div class="cart-actions">
            <button id="btnCobrar" class="btn primary">Cobrar</button>
            <button id="btnVaciar" class="btn">Vaciar</button>
          </div>
        </aside>

        <button id="btnCarritoMovil" class="btn floating show-on-mobile">Carrito</button>
      </div>
    </section>

    <!-- ============= INVENTARIO ============= -->
    <section id="inventario" class="view">
      <div class="inv-toolbar">
        <button id="btnNuevoProd" class="btn primary">+ Producto</button>
        <label class="filelike"><input id="fileImport" type="file" accept=".csv" hidden/>Importar CSV</label>
        <input id="invBuscar" class="input" placeholder="Filtrar por nombre/SKU‚Ä¶"/>
        <select id="invEtiqueta" class="input">
          <option value="">Etiqueta (todas)</option>
          <option>Gen√©rico</option><option>Marca</option><option>Controlado</option><option>Servicio</option>
        </select>
      </div>
      <div class="badges">
        <span id="badgeStock" class="chip warn">Stock bajo: 0</span>
        <span id="badgeCad" class="chip danger">Pr√≥ximas caducidades: 0</span>
      </div>
      <div class="table-wrap">
        <table id="tablaInv" class="table">
          <thead>
            <tr>
              <th>IMG</th><th>SKU</th><th>Nombre</th><th>Etiqueta</th><th>Precio</th>
              <th>Stock</th><th>M√≠n</th><th>Lotes</th><th>Cad. Pr√≥x.</th><th>Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ============= BODEGA (placeholder) ============= -->
    <section id="bodega" class="view">
      <div class="grid2">
        <div class="card">
          <h3>Solicitudes desde Inventario</h3>
          <table class="table" id="tblSolicitudes">
            <thead><tr><th>Folio</th><th>SKU</th><th>Piezas</th><th>Estado</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="card">
          <h3>Recepci√≥n (Inventario)</h3>
          <div id="recepcionPanel">(Selecciona una solicitud)</div>
        </div>
      </div>
    </section>

    <!-- ============= CLIENTES ============= -->
    <section id="clientes" class="view">
      <div class="inv-toolbar">
        <button id="btnNuevoCliente" class="btn primary">+ Cliente</button>
        <label class="filelike"><input id="fileImportClientes" type="file" accept=".csv" hidden/>Importar CSV</label>
        <input id="buscarCliente" class="input" placeholder="Buscar cliente‚Ä¶"/>
      </div>
      <div class="table-wrap">
        <table id="tablaClientes" class="table">
          <thead><tr><th>Nombre</th><th>Tel√©fono</th><th>Email</th><th>Compras</th><th>√öltima compra</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ============= HISTORIAL ============= -->
    <section id="historial" class="view">
      <div class="inv-toolbar">
        <input id="fhDesde" type="date" class="input"/>
        <span>‚Äî</span>
        <input id="fhHasta" type="date" class="input"/>
        <button id="btnFiltrarHist" class="btn">Filtrar</button>
        <button id="btnExportHist" class="btn">Exportar</button>
      </div>
      <div class="table-wrap">
        <table id="tablaHistorial" class="table">
          <thead><tr><th>Folio</th><th>Fecha/Hora</th><th>Cliente</th><th>Total</th><th>Pago</th><th>Receta</th><th>Estado</th><th>Acciones</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ============= REPORTES ============= -->
    <section id="reportes" class="view">
      <div class="tabs">
        <button data-tab="d" class="tab active">Diario</button>
        <button data-tab="s" class="tab">Semanal</button>
        <button data-tab="r" class="tab">Rango</button>
        <button id="btnExportRep" class="btn">Exportar</button>
      </div>
      <div class="card">
        <h3>Resumen</h3>
        <div id="repResumen">‚Äî</div>
      </div>
    </section>

    <!-- Ticket -->
    <dialog id="dlgTicket" class="modal">
      <div class="form">
        <h3>Ticket 58 mm</h3>
        <div id="ticketPreview" class="ticket"></div>
        <div class="modal-actions">
          <button id="btnPrintTicket" class="btn primary" type="button">Imprimir</button>
          <button id="btnCloseTicket" class="btn" type="button">Cerrar</button>
        </div>
      </div>
    </dialog>

    <!-- Modales Inventario -->
    <dialog id="dlgProd" class="modal">
      <form method="dialog" class="form" novalidate>
        <h3 id="dlgProdTitle">Nuevo producto</h3>
        <div class="grid2">
          <label>SKU <input id="fSku" required/></label>
          <label>Nombre <input id="fNombre" required/></label>
          <label>Etiqueta
            <select id="fEtiqueta">
              <option>Gen√©rico</option><option>Marca</option><option>Controlado</option><option>Servicio</option>
            </select>
          </label>
          <label>Precio (venta) <input id="fPrecio" type="number" step="0.01" required/></label>
          <label>Costo <input id="fCosto" type="number" step="0.01"/></label>
          <label>Stock m√≠nimo <input id="fMin" type="number" step="1" value="0"/></label>
        </div>

        <div class="grid2" style="margin-top:10px">
          <label>Imagen (archivo)
            <input id="fImgFile" type="file" accept="image/*"/>
            <img id="fImgPrev" class="logo-prev" style="margin-top:6px" alt="Vista previa"/>
            <button id="fImgQuitar" type="button" class="btn" style="margin-top:6px">Quitar imagen</button>
          </label>
          <div>
            <label>Lote inicial (opcional) <input id="fLote0"/></label>
            <label>Caducidad inicial <input id="fCad0" type="date"/></label>
            <label>Piezas iniciales <input id="fPzs0" type="number" step="1" min="0"/></label>
          </div>
        </div>

        <div class="modal-actions">
          <button id="btnCancelProd" class="btn" type="button">Cancelar</button>
          <button id="btnGuardarProd" class="btn primary" value="default">Guardar</button>
        </div>
      </form>
    </dialog>

    <dialog id="dlgStock" class="modal">
      <form method="dialog" class="form">
        <h3>Agregar stock (lote)</h3>
        <div class="grid2">
          <label>Lote <input id="sLote" required/></label>
          <label>Caducidad <input id="sCad" type="date"/></label>
          <label>Piezas <input id="sPiezas" type="number" step="1" required/></label>
        </div>
        <div class="modal-actions">
          <button id="btnCancelStock" class="btn" type="button">Cancelar</button>
          <button id="btnGuardarStock" class="btn primary" value="default">Agregar</button>
        </div>
      </form>
    </dialog>
  </main>

  <script src="app.js?v=dp-1.9"></script>
</body>
</html>
